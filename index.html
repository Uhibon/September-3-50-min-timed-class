<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boo-riculum â€“ People at School Deck</title>
  <link rel="icon" type="image/png" href="booha-ghost.png">
  <style>
    :root { --ink:#222; --muted:#444; --accent:#0b78ff; --ok:#22c55e; --bad:#ef4444; }
    html,body{height:100%;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background:url('booha-card.jpg') center/cover fixed no-repeat;
    }
    .wrap{max-width:900px;margin:0 auto;padding:16px 16px 24px;}
    header{
      display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;
      margin-bottom:12px;background:rgba(255,255,255,0.88);padding:12px 16px;
      border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,0.15)
    }
    header h1{
      font-size:18px;margin:0;font-weight:700;letter-spacing:.2px;
      background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      display:flex;align-items:center;gap:8px
    }
    header h1 img{height:28px;width:auto;}
    .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    select,button{
      background:rgba(255,255,255,0.95);color:var(--ink);border:1px solid #ccc;
      border-radius:12px;padding:10px 12px;font-size:14px;
      box-shadow:0 2px 5px rgba(0,0,0,0.08)
    }
    button{cursor:pointer;transition:transform .05s ease, background .2s}
    button:hover{background:#f0f0f0}
    button:active{transform:scale(.98)}
    .pill{border:1px solid #ccc;border-radius:999px;padding:6px 10px;font-size:12px;background:rgba(255,255,255,0.7)}
    .card{
      user-select:none;-webkit-user-select:none;display:flex;flex-direction:column;justify-content:center;align-items:center;
      text-align:center;background:url('booha-card.jpg') center/cover no-repeat;
      border:1px solid #ccc;border-radius:24px;min-height:56vh;margin:16px auto;padding:22px 18px 28px;
      box-shadow:0 10px 40px rgba(0,0,0,.25); position:relative;
    }
    .brand{
      position:absolute;top:10px;left:12px;display:flex;gap:8px;align-items:center;
      background:rgba(255,255,255,0.85);padding:6px 10px;border-radius:12px;border:1px solid #ddd;
      box-shadow:0 2px 6px rgba(0,0,0,0.08); font-weight:800; letter-spacing:.2px;
    }
    .brand img{height:20px;width:auto}
    .brand span{background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .label{color:var(--muted);font-size:13px;letter-spacing:.3px;margin-bottom:8px;
      background:rgba(255,255,255,0.7);padding:4px 8px;border-radius:8px}
    .main{font-size:28px;line-height:1.25;font-weight:800;margin:8px 0 10px;
      background:rgba(255,255,255,0.86);padding:8px 12px;border-radius:12px}
    .sub{font-size:18px;opacity:.92;margin:0 0 6px;background:rgba(255,255,255,0.65);
      padding:4px 10px;border-radius:8px}
    .hira{font-size:18px;color:var(--accent);opacity:.95;background:rgba(255,255,255,0.75);
      padding:4px 10px;border-radius:8px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .footer{
      display:flex;align-items:center;justify-content:space-between;margin-top:8px;color:var(--muted);font-size:13px;
      background:rgba(255,255,255,0.85);padding:8px 12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)
    }
    .progress{height:8px;border-radius:999px;background:#eee;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,#7dd3fc,#60a5fa,#a78bfa,#f472b6);width:0%}
    .hidden{display:none}
    .options{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .optbtn{border:1px solid #ccc;border-radius:12px;padding:10px 14px;background:rgba(255,255,255,0.95);cursor:pointer}
    .optbtn.ok{background:#dcfce7;border-color:#86efac;color:#166534}
    .optbtn.bad{background:#fee2e2;border-color:#fca5a5;color:#991b1b}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1><img src="booha-ghost.png" alt="Booha ghost"> Boo-riculum â€“ People at School</h1>
      <div class="controls">
        <select id="mode" aria-label="Mode">
          <option value="vocab-j2e">Vocab: ğŸ‡¯ğŸ‡µ â†’ ğŸ‡ºğŸ‡¸</option>
          <option value="vocab-e2j">Vocab: ğŸ‡ºğŸ‡¸ â†’ ğŸ‡¯ğŸ‡µ</option>
          <option value="sentences">Sentences (practice)</option>
          <option value="qa">Questions (practice)</option>
          <option value="quiz">Quiz (multiple choice)</option>
          <option value="reading">Reading</option>
        </select>
      </div>
    </header>

    <div id="card" class="card" role="button" aria-label="flashcard" tabindex="0">
      <div class="brand"><img src="booha-ghost.png" alt="Booha ghost"><span>Boo-riculum</span></div>
      <div id="label" class="label">Front</div>
      <div id="main" class="main">â€”</div>
      <div id="sub" class="sub muted">Tap or press Space to flip</div>
      <div id="hira" class="hira hidden"></div>
      <div id="mcArea" class="options hidden"></div>
    </div>

    <div class="footer">
      <div class="row">
        <span class="pill">Keyboard: â† â†’</span>
        <span class="pill">Space = Flip</span>
        <button id="btnPrev">â—€ï¸ Prev</button>
        <button id="btnFlip">Flip</button>
        <button id="btnNext">Next â–¶ï¸</button>
        <button id="btnShuffle">Shuffle</button>
      </div>
      <div style="min-width:180px;text-align:right">
        <div id="counter" class="muted">0 / 0</div>
        <div class="progress"><span id="bar"></span></div>
      </div>
    </div>
  </div>

  <script>
    // ---------------- Data ----------------
    const PEOPLE = [
      { en: 'teacher', ja: 'å…ˆç”Ÿ', hira: 'ã›ã‚“ã›ã„' },
      { en: 'student', ja: 'ç”Ÿå¾’', hira: 'ã›ã„ã¨' },
      { en: 'principal', ja: 'æ ¡é•·å…ˆç”Ÿ', hira: 'ã“ã†ã¡ã‚‡ã†ã›ã‚“ã›ã„' },
      { en: 'nurse', ja: 'ä¿å¥ã®å…ˆç”Ÿ', hira: 'ã»ã‘ã‚“ã®ã›ã‚“ã›ã„' },
      { en: 'librarian', ja: 'å›³æ›¸é¤¨ã®å…ˆç”Ÿ', hira: 'ã¨ã—ã‚‡ã‹ã‚“ã®ã›ã‚“ã›ã„' },
      { en: 'janitor', ja: 'ç”¨å‹™å“¡ã•ã‚“', hira: 'ã‚ˆã†ã‚€ã„ã‚“ã•ã‚“' },
      { en: 'counselor', ja: 'ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼', hira: 'ã‹ã†ã‚“ã›ã‚‰ãƒ¼' },
      { en: 'vice principal', ja: 'æ•™é ­å…ˆç”Ÿ', hira: 'ãã‚‡ã†ã¨ã†ã›ã‚“ã›ã„' },
      { en: 'office worker', ja: 'äº‹å‹™ã®äºº', hira: 'ã˜ã‚€ã®ã²ã¨' },
      { en: 'lunch staff', ja: 'çµ¦é£Ÿã®ã‚¹ã‚¿ãƒƒãƒ•', hira: 'ãã‚…ã†ã—ã‚‡ãã®ã™ãŸã£ãµ' }
    ];
    
      const ROLES = [
      { en: 'teach',   ja: 'æ•™ãˆã‚‹',    hira: 'ãŠã—ãˆã‚‹' },
      { en: 'help',    ja: 'åŠ©ã‘ã‚‹',    hira: 'ãŸã™ã‘ã‚‹' },
      { en: 'clean',   ja: 'æƒé™¤ã™ã‚‹',  hira: 'ãã†ã˜ã™ã‚‹' },
      { en: 'manage',  ja: 'ç®¡ç†ã™ã‚‹',  hira: 'ã‹ã‚“ã‚Šã™ã‚‹' },
      { en: 'guide',   ja: 'æŒ‡å°ã™ã‚‹',  hira: 'ã—ã©ã†ã™ã‚‹' },
      { en: 'write',   ja: 'æ›¸ã',      hira: 'ã‹ã' },
      { en: 'read',    ja: 'èª­ã‚€',      hira: 'ã‚ˆã‚€' },
      { en: 'talk',    ja: 'è©±ã™',      hira: 'ã¯ãªã™' },
      { en: 'check',   ja: 'ã¯ã‹ã‚‹',    hira: 'ã¯ã‹ã‚‹' },
      { en: 'organize',ja: 'æ•´ç†ã™ã‚‹',  hira: 'ã›ã„ã‚Šã™ã‚‹' },
      { en: 'open',    ja: 'é–‹ã‘ã‚‹',    hira: 'ã‚ã‘ã‚‹' },
      { en: 'listen',  ja: 'èã',      hira: 'ãã' },
      { en: 'serve',   ja: 'å‡ºã™',      hira: 'ã ã™' },
      { en: 'answer',  ja: 'å‡ºã‚‹',      hira: 'ã§ã‚‹' },
    ];
    
    const SENTENCES = [
      { en: 'The teacher teaches math.', ja: 'å…ˆç”Ÿã¯æ•°å­¦ã‚’æ•™ãˆã¾ã™ã€‚', hira: 'ã›ã‚“ã›ã„ã¯ã™ã†ãŒãã‚’ãŠã—ãˆã¾ã™ã€‚' },
      { en: 'Students listen to the teacher.', ja: 'ç”Ÿå¾’ãŸã¡ã¯å…ˆç”Ÿã®è©±ã‚’èãã¾ã™ã€‚', hira: 'ã›ã„ã¨ãŸã¡ã¯ã›ã‚“ã›ã„ã®ã¯ãªã—ã‚’ããã¾ã™ã€‚' },
      { en: 'The principal manages the school.', ja: 'æ ¡é•·å…ˆç”Ÿã¯å­¦æ ¡ã‚’ç®¡ç†ã—ã¾ã™ã€‚', hira: 'ã“ã†ã¡ã‚‡ã†ã›ã‚“ã›ã„ã¯ãŒã£ã“ã†ã‚’ã‹ã‚“ã‚Šã—ã¾ã™ã€‚' },
      { en: 'The nurse helps sick students.', ja: 'ä¿å¥ã®å…ˆç”Ÿã¯å…·åˆãŒæ‚ªã„ç”Ÿå¾’ã‚’åŠ©ã‘ã¾ã™ã€‚', hira: 'ã»ã‘ã‚“ã®ã›ã‚“ã›ã„ã¯ãã‚ã„ãŒã‚ã‚‹ã„ã›ã„ã¨ã‚’ãŸã™ã‘ã¾ã™ã€‚' },
      { en: 'The librarian gives books to students.', ja: 'å›³æ›¸é¤¨ã®å…ˆç”Ÿã¯ç”Ÿå¾’ã«æœ¬ã‚’è²¸ã—ã¾ã™ã€‚', hira: 'ã¨ã—ã‚‡ã‹ã‚“ã®ã›ã‚“ã›ã„ã¯ã›ã„ã¨ã«ã»ã‚“ã‚’ã‹ã—ã¾ã™ã€‚' },
      { en: 'The janitor cleans the school.', ja: 'ç”¨å‹™å“¡ã•ã‚“ã¯å­¦æ ¡ã‚’æƒé™¤ã—ã¾ã™ã€‚', hira: 'ã‚ˆã†ã‚€ã„ã‚“ã•ã‚“ã¯ãŒã£ã“ã†ã‚’ãã†ã˜ã—ã¾ã™ã€‚' },
      { en: 'The counselor guides students.', ja: 'ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ã¯ç”Ÿå¾’ã‚’æŒ‡å°ã—ã¾ã™ã€‚', hira: 'ã‹ã†ã‚“ã›ã‚‰ãƒ¼ã¯ã›ã„ã¨ã‚’ã—ã©ã†ã—ã¾ã™ã€‚' },
      { en: 'The vice principal helps the teachers.', ja: 'æ•™é ­å…ˆç”Ÿã¯å…ˆç”ŸãŸã¡ã‚’åŠ©ã‘ã¾ã™ã€‚', hira: 'ãã‚‡ã†ã¨ã†ã›ã‚“ã›ã„ã¯ã›ã‚“ã›ã„ãŸã¡ã‚’ãŸã™ã‘ã¾ã™ã€‚' },
      { en: 'The school lunch staff makes our lunch.', ja: 'çµ¦é£Ÿã®ã‚¹ã‚¿ãƒƒãƒ•ã¯ç§ãŸã¡ã®æ˜¼ã”ã¯ã‚“ã‚’ä½œã‚Šã¾ã™ã€‚', hira: 'ãã‚…ã†ã—ã‚‡ãã®ã™ãŸã£ãµã¯ã‚ãŸã—ãŸã¡ã®ã²ã‚‹ã”ã¯ã‚“ã‚’ã¤ãã‚Šã¾ã™ã€‚' },
      { en: 'The office worker answers the phone.', ja: 'äº‹å‹™ã®äººã¯é›»è©±ã«å‡ºã¾ã™ã€‚', hira: 'ã˜ã‚€ã®ã²ã¨ã¯ã§ã‚“ã‚ã«ã§ã¾ã™ã€‚' }
    ];

    const QA = [
      { q_en:'What does the teacher do?', q_ja:'å…ˆç”Ÿã¯ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ', q_hira:'ã›ã‚“ã›ã„ã¯ãªã«ã‚’ã—ã¾ã™ã‹ï¼Ÿ',
        a_en:'The teacher teaches math.', a_ja:'å…ˆç”Ÿã¯æ•°å­¦ã‚’æ•™ãˆã¾ã™ã€‚', a_hira:'ã›ã‚“ã›ã„ã¯ã™ã†ãŒãã‚’ãŠã—ãˆã¾ã™ã€‚' },
      { q_en:'Who listens to the teacher?', q_ja:'èª°ãŒå…ˆç”Ÿã®è©±ã‚’èãã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒã›ã‚“ã›ã„ã®ã¯ãªã—ã‚’ããã¾ã™ã‹ï¼Ÿ',
        a_en:'The students listen to the teacher.', a_ja:'ç”Ÿå¾’ãŸã¡ã¯å…ˆç”Ÿã®è©±ã‚’èãã¾ã™ã€‚', a_hira:'ã›ã„ã¨ãŸã¡ã¯ã›ã‚“ã›ã„ã®ã¯ãªã—ã‚’ããã¾ã™ã€‚' },
      { q_en:'Who manages the school?', q_ja:'èª°ãŒå­¦æ ¡ã‚’ç®¡ç†ã—ã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒãŒã£ã“ã†ã‚’ã‹ã‚“ã‚Šã—ã¾ã™ã‹ï¼Ÿ',
        a_en:'The principal manages the school.', a_ja:'æ ¡é•·å…ˆç”Ÿã¯å­¦æ ¡ã‚’ç®¡ç†ã—ã¾ã™ã€‚', a_hira:'ã“ã†ã¡ã‚‡ã†ã›ã‚“ã›ã„ã¯ãŒã£ã“ã†ã‚’ã‹ã‚“ã‚Šã—ã¾ã™ã€‚' },
      { q_en:'Who helps sick students?', q_ja:'èª°ãŒå…·åˆãŒæ‚ªã„ç”Ÿå¾’ã‚’åŠ©ã‘ã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒãã‚ã„ãŒã‚ã‚‹ã„ã›ã„ã¨ã‚’ãŸã™ã‘ã¾ã™ã‹ï¼Ÿ',
        a_en:'The nurse helps sick students.', a_ja:'ä¿å¥ã®å…ˆç”Ÿã¯å…·åˆãŒæ‚ªã„ç”Ÿå¾’ã‚’åŠ©ã‘ã¾ã™ã€‚', a_hira:'ã»ã‘ã‚“ã®ã›ã‚“ã›ã„ã¯ãã‚ã„ãŒã‚ã‚‹ã„ã›ã„ã¨ã‚’ãŸã™ã‘ã¾ã™ã€‚' },
      { q_en:'Who gives books to students?', q_ja:'èª°ãŒç”Ÿå¾’ã«æœ¬ã‚’è²¸ã—ã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒã›ã„ã¨ã«ã»ã‚“ã‚’ã‹ã—ã¾ã™ã‹ï¼Ÿ',
        a_en:'The librarian gives books.', a_ja:'å›³æ›¸é¤¨ã®å…ˆç”ŸãŒæœ¬ã‚’è²¸ã—ã¾ã™ã€‚', a_hira:'ã¨ã—ã‚‡ã‹ã‚“ã®ã›ã‚“ã›ã„ãŒã»ã‚“ã‚’ã‹ã—ã¾ã™ã€‚' },
      { q_en:'Who cleans the school?', q_ja:'èª°ãŒå­¦æ ¡ã‚’æƒé™¤ã—ã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒãŒã£ã“ã†ã‚’ãã†ã˜ã—ã¾ã™ã‹ï¼Ÿ',
        a_en:'The janitor cleans the school.', a_ja:'ç”¨å‹™å“¡ã•ã‚“ãŒæƒé™¤ã—ã¾ã™ã€‚', a_hira:'ã‚ˆã†ã‚€ã„ã‚“ã•ã‚“ãŒãã†ã˜ã—ã¾ã™ã€‚' },
      { q_en:'Who guides the students?', q_ja:'èª°ãŒç”Ÿå¾’ã‚’æŒ‡å°ã—ã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒã›ã„ã¨ã‚’ã—ã©ã†ã—ã¾ã™ã‹ï¼Ÿ',
        a_en:'The counselor guides them.', a_ja:'ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ãŒæŒ‡å°ã—ã¾ã™ã€‚', a_hira:'ã‹ã†ã‚“ã›ã‚‰ãƒ¼ãŒã—ã©ã†ã—ã¾ã™ã€‚' },
      { q_en:'Who helps the teachers?', q_ja:'èª°ãŒå…ˆç”ŸãŸã¡ã‚’åŠ©ã‘ã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒã›ã‚“ã›ã„ãŸã¡ã‚’ãŸã™ã‘ã¾ã™ã‹ï¼Ÿ',
        a_en:'The vice principal helps.', a_ja:'æ•™é ­å…ˆç”ŸãŒåŠ©ã‘ã¾ã™ã€‚', a_hira:'ãã‚‡ã†ã¨ã†ã›ã‚“ã›ã„ãŒãŸã™ã‘ã¾ã™ã€‚' },
      { q_en:'Who makes lunch?', q_ja:'èª°ãŒæ˜¼ã”ã¯ã‚“ã‚’ä½œã‚Šã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒã²ã‚‹ã”ã¯ã‚“ã‚’ã¤ãã‚Šã¾ã™ã‹ï¼Ÿ',
        a_en:'The lunch staff makes lunch.', a_ja:'çµ¦é£Ÿã®ã‚¹ã‚¿ãƒƒãƒ•ãŒä½œã‚Šã¾ã™ã€‚', a_hira:'ãã‚…ã†ã—ã‚‡ãã®ã™ãŸã£ãµãŒã¤ãã‚Šã¾ã™ã€‚' },
      { q_en:'Who answers the phone?', q_ja:'èª°ãŒé›»è©±ã«å‡ºã¾ã™ã‹ï¼Ÿ', q_hira:'ã ã‚ŒãŒã§ã‚“ã‚ã«ã§ã¾ã™ã‹ï¼Ÿ',
        a_en:'The office worker answers.', a_ja:'äº‹å‹™ã®äººãŒå‡ºã¾ã™ã€‚', a_hira:'ã˜ã‚€ã®ã²ã¨ãŒã§ã¾ã™ã€‚' }
    ];

    const QUIZ = [
      { cloze:'The teacher ___ math.', answers:['teaches'], ja:'å…ˆç”Ÿã¯æ•°å­¦ã‚’æ•™ãˆã¾ã™ã€‚', hira:'ã›ã‚“ã›ã„ã¯ã™ã†ãŒãã‚’ãŠã—ãˆã¾ã™ã€‚', full:'The teacher teaches math.' },
      { cloze:'Students ___ to the teacher.', answers:['listen'], ja:'ç”Ÿå¾’ãŸã¡ã¯å…ˆç”Ÿã®è©±ã‚’èãã¾ã™ã€‚', hira:'ã›ã„ã¨ãŸã¡ã¯ã›ã‚“ã›ã„ã®ã¯ãªã—ã‚’ããã¾ã™ã€‚', full:'Students listen to the teacher.' },
      { cloze:'The principal ___ the school.', answers:['manages'], ja:'æ ¡é•·å…ˆç”Ÿã¯å­¦æ ¡ã‚’ç®¡ç†ã—ã¾ã™ã€‚', hira:'ã“ã†ã¡ã‚‡ã†ã›ã‚“ã›ã„ã¯ãŒã£ã“ã†ã‚’ã‹ã‚“ã‚Šã—ã¾ã™ã€‚', full:'The principal manages the school.' },
      { cloze:'The nurse ___ sick students.', answers:['helps'], ja:'ä¿å¥ã®å…ˆç”Ÿã¯å…·åˆãŒæ‚ªã„ç”Ÿå¾’ã‚’åŠ©ã‘ã¾ã™ã€‚', hira:'ã»ã‘ã‚“ã®ã›ã‚“ã›ã„ã¯ãã‚ã„ãŒã‚ã‚‹ã„ã›ã„ã¨ã‚’ãŸã™ã‘ã¾ã™ã€‚', full:'The nurse helps sick students.' },
      { cloze:'The librarian ___ books.', answers:['gives','lends'], ja:'å›³æ›¸é¤¨ã®å…ˆç”Ÿã¯ç”Ÿå¾’ã«æœ¬ã‚’è²¸ã—ã¾ã™ã€‚', hira:'ã¨ã—ã‚‡ã‹ã‚“ã®ã›ã‚“ã›ã„ã¯ã»ã‚“ã‚’ã‹ã—ã¾ã™ã€‚', full:'The librarian gives books.' },
      { cloze:'The janitor ___ the school.', answers:['cleans'], ja:'ç”¨å‹™å“¡ã•ã‚“ã¯å­¦æ ¡ã‚’æƒé™¤ã—ã¾ã™ã€‚', hira:'ã‚ˆã†ã‚€ã„ã‚“ã•ã‚“ã¯ãŒã£ã“ã†ã‚’ãã†ã˜ã—ã¾ã™ã€‚', full:'The janitor cleans the school.' },
      { cloze:'The counselor ___ students.', answers:['guides'], ja:'ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ã¯ç”Ÿå¾’ã‚’æŒ‡å°ã—ã¾ã™ã€‚', hira:'ã‹ã†ã‚“ã›ã‚‰ãƒ¼ã¯ã›ã„ã¨ã‚’ã—ã©ã†ã—ã¾ã™ã€‚', full:'The counselor guides students.' },
      { cloze:'The vice principal ___ teachers.', answers:['helps'], ja:'æ•™é ­å…ˆç”Ÿã¯å…ˆç”ŸãŸã¡ã‚’åŠ©ã‘ã¾ã™ã€‚', hira:'ãã‚‡ã†ã¨ã†ã›ã‚“ã›ã„ã¯ã›ã‚“ã›ã„ãŸã¡ã‚’ãŸã™ã‘ã¾ã™ã€‚', full:'The vice principal helps teachers.' },
      { cloze:'The lunch staff ___ lunch.', answers:['makes','prepare','prepares'], ja:'çµ¦é£Ÿã®ã‚¹ã‚¿ãƒƒãƒ•ã¯æ˜¼ã”ã¯ã‚“ã‚’ä½œã‚Šã¾ã™ã€‚', hira:'ãã‚…ã†ã—ã‚‡ãã®ã™ãŸã£ãµã¯ã²ã‚‹ã”ã¯ã‚“ã‚’ã¤ãã‚Šã¾ã™ã€‚', full:'The lunch staff makes lunch.' },
      { cloze:'The office worker ___ the phone.', answers:['answers'], ja:'äº‹å‹™ã®äººã¯é›»è©±ã«å‡ºã¾ã™ã€‚', hira:'ã˜ã‚€ã®ã²ã¨ã¯ã§ã‚“ã‚ã«ã§ã¾ã™ã€‚', full:'The office worker answers the phone.' }
    ];

    const READINGS = [
      { en:'At school, many people help us. Teachers teach, the principal manages, and the nurse helps when we are sick. Everyone works together.', ja:'å­¦æ ¡ã§ã¯ãŸãã•ã‚“ã®äººãŒåŠ©ã‘ã¦ãã‚Œã¾ã™ã€‚å…ˆç”Ÿã¯æ•™ãˆã€æ ¡é•·å…ˆç”Ÿã¯ç®¡ç†ã—ã€ä¿å¥ã®å…ˆç”Ÿã¯ç—…æ°—ã®æ™‚ã«åŠ©ã‘ã¦ãã‚Œã¾ã™ã€‚ã¿ã‚“ãªãŒå”åŠ›ã—ã¦ã„ã¾ã™ã€‚', hira:'ãŒã£ã“ã†ã§ã¯ãŸãã•ã‚“ã®ã²ã¨ãŒãŸã™ã‘ã¦ãã‚Œã¾ã™ã€‚ã›ã‚“ã›ã„ã¯ãŠã—ãˆã€ã“ã†ã¡ã‚‡ã†ã›ã‚“ã›ã„ã¯ã‹ã‚“ã‚Šã—ã€ã»ã‘ã‚“ã®ã›ã‚“ã›ã„ã¯ã³ã‚‡ã†ãã®ã¨ãã«ãŸã™ã‘ã¦ãã‚Œã¾ã™ã€‚ã¿ã‚“ãªãŒãã‚‡ã†ã‚Šã‚‡ãã—ã¦ã„ã¾ã™ã€‚' },
      { en:'The librarian gives us books to read, and the janitor cleans the classrooms. The office worker answers the phone and helps parents who visit.', ja:'å›³æ›¸é¤¨ã®å…ˆç”Ÿã¯æœ¬ã‚’è²¸ã—ã¦ãã‚Œã€ç”¨å‹™å“¡ã•ã‚“ã¯æ•™å®¤ã‚’æƒé™¤ã—ã¾ã™ã€‚äº‹å‹™ã®äººã¯é›»è©±ã«å‡ºã¦ã€æ¥æ ¡ã—ãŸä¿è­·è€…ã‚’åŠ©ã‘ã¾ã™ã€‚', hira:'ã¨ã—ã‚‡ã‹ã‚“ã®ã›ã‚“ã›ã„ã¯ã»ã‚“ã‚’ã‹ã—ã¦ãã‚Œã€ã‚ˆã†ã‚€ã„ã‚“ã•ã‚“ã¯ãã‚‡ã†ã—ã¤ã‚’ãã†ã˜ã—ã¾ã™ã€‚ã˜ã‚€ã®ã²ã¨ã¯ã§ã‚“ã‚ã«ã§ã¦ã€ã‚‰ã„ã“ã†ã—ãŸã»ã”ã—ã‚ƒã‚’ãŸã™ã‘ã¾ã™ã€‚' }
    ];

    // -------------- State & Elements --------------
    let deck = [];
    let index = 0;
    let showingFront = true;

    const els = {
      mode: document.getElementById('mode'),
      card: document.getElementById('card'),
      label: document.getElementById('label'),
      main: document.getElementById('main'),
      sub: document.getElementById('sub'),
      hira: document.getElementById('hira'),
      counter: document.getElementById('counter'),
      bar: document.getElementById('bar'),
      btnPrev: document.getElementById('btnPrev'),
      btnNext: document.getElementById('btnNext'),
      btnFlip: document.getElementById('btnFlip'),
      btnShuffle: document.getElementById('btnShuffle'),
      mcArea: document.getElementById('mcArea'),
    };

    // Helpers
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]} return arr; }
    const ALL_QUIZ_WORDS = Array.from(new Set(QUIZ.flatMap(q=>q.answers.map(a=>a.toLowerCase()))));
    function mcOptionsFor(item, n=4){
      const corrects=item.answers.map(a=>a.toLowerCase());
      const pool=ALL_QUIZ_WORDS.filter(v=>!corrects.includes(v));
      shuffle(pool);
      return shuffle([corrects[0], ...pool.slice(0,n-1)]);
    }

    // Build deck
    function buildDeck(){
      const mode=els.mode.value;
      if(mode==='vocab-j2e' || mode==='vocab-e2j'){
        const combined=[...PEOPLE];
        deck=combined.map(x=>({
          type:'vocab', front:mode==='vocab-j2e'?x.ja:x.en, back:mode==='vocab-j2e'?x.en:x.ja, hira:x.hira,
          sideLabelFront:mode==='vocab-j2e'?'Japanese â†’ English':'English â†’ Japanese', sideLabelBack:mode==='vocab-j2e'?'English':'Japanese'
        }));
      } else if(mode==='sentences'){
        deck=SENTENCES.map(s=>({type:'sentence',front:s.ja,back:s.en+'\n'+s.ja,hira:s.hira,sideLabelFront:'Japanese sentence',sideLabelBack:'Answer'}));
      } else if(mode==='qa'){
        deck=QA.map(q=>({type:'qa',front:q.q_ja,back:q.a_en+'\n'+q.a_ja,hira:q.q_hira+'\n'+q.a_hira,sideLabelFront:'Question (JA)',sideLabelBack:'Answer'}));
      } else if(mode==='quiz'){
        deck=QUIZ.map(q=>({type:'quiz',front:q.cloze,back:q.full+'\n'+q.ja,hira:q.hira,answers:q.answers,choices:mcOptionsFor(q,4),sideLabelFront:'Choose',sideLabelBack:'Answer'}));
      } else if(mode==='reading'){
        deck=READINGS.map(r=>({type:'reading',front:r.ja,back:r.en+'\n'+r.ja,hira:r.hira,sideLabelFront:'Reading (JA)',sideLabelBack:'Reading (EN+JA)'}));
      } else { deck=[]; }
      index=0;showingFront=true;render();
    }

    // Render
    function render(){
      if(deck.length===0){els.main.textContent='â€”'; els.sub.textContent='Choose a mode'; return;}
      const item=deck[index]; els.label.textContent=showingFront?item.sideLabelFront:item.sideLabelBack;
      const content=showingFront?item.front:item.back;
      if(!showingFront && content.includes('\n')){
        const [en,ja]=content.split('\n'); els.main.innerHTML=`<div style="font-size:22px;font-weight:700">${en}</div><div class="sub">${ja}</div>`;
      } else { els.main.textContent=content; }
      if(item.hira){ els.hira.classList.remove('hidden'); els.hira.textContent=item.hira; } else { els.hira.classList.add('hidden'); els.hira.textContent=''; }
      if(item.type==='quiz' && showingFront){
        els.mcArea.classList.remove('hidden'); els.mcArea.innerHTML=''; item.choices.forEach(opt=>{
          const btn=document.createElement('button'); btn.className='optbtn'; btn.textContent=opt;
          btn.addEventListener('click',e=>{
            e.preventDefault(); const norm=s=>s.toLowerCase().trim(); const isCorrect=item.answers.map(a=>norm(a)).includes(norm(opt));
            if(isCorrect){ btn.classList.add('ok'); [...els.mcArea.querySelectorAll('button')].forEach(b=>b.disabled=true); setTimeout(()=>{showingFront=false;render();},350); }
            else{ btn.classList.add('bad'); btn.disabled=true; }
          });
          els.mcArea.appendChild(btn);
        });
      } else { els.mcArea.classList.add('hidden'); els.mcArea.innerHTML=''; }
      els.counter.textContent=`${index+1} / ${deck.length}`; els.bar.style.width=`${((index+1)/deck.length)*100}%`;
    }

    // Navigation
    function prev(){index=(index-1+deck.length)%deck.length;showingFront=true;render();}
    function next(){index=(index+1)%deck.length;showingFront=true;render();}
    function flip(){showingFront=!showingFront;render();}
    function shuffleDeck(){deck=shuffle(deck);index=0;showingFront=true;render();}

    // Events
    els.mode.addEventListener('change',buildDeck);
    document.getElementById('btnPrev').addEventListener('click',prev);
    document.getElementById('btnNext').addEventListener('click',next);
    document.getElementById('btnFlip').addEventListener('click',flip);
    document.getElementById('btnShuffle').addEventListener('click',shuffleDeck);
    window.addEventListener('keydown',e=>{if(e.code==='ArrowLeft')prev(); else if(e.code==='ArrowRight')next(); else if(e.code==='Space')flip();});

    // Init
    buildDeck();
  </script>
</body>
</html>
